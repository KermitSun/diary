<h1 align="center">mysql索引基础</h1>

# 1 全局锁
## 1-1 FTWRL
- 执行命令Flush tables with read lock，对数据库添加全局读锁，库处于只读状态；
- 之后其他线程的增删改语句，数据定义语句和更新类的事务提交会被阻塞；
- 用于做全库逻辑备份；
    
## 1-2 一致性视图
- 只支持InnoDB，因为只有其才有一致性视图；
- 用于全局备份；
- 不锁表，备份期间依然能够curd；
    
## 1-3 设置只读
- 修改配置  set global readonly=true
- 缺陷是连接断了的话，不能还原状态，造成一直只读，而FTWRL能够在断开连接后恢复数据库只读状态；
- set global readonly=true通常被用来标记从库；
       
# 2 表级锁
没有行级锁才会选用表级锁；

## 2-1 表锁
- 引擎通用，但是InnoDB一般不使用；
- 语法 lock tables ... read/write
- 与客户端断开连接后主动释放锁
- lock tables t1 read, t2 write，t1表加读锁，t2表加写锁
- 读锁 当前线程 只能读 其他线程 只能读
- 写锁 当前线程 可读写 其他线程 不能读写
- unlock tables t1 read, t2 write，解锁

## 2-2 元数据锁
- meta data lock，简称mdl锁；
- 访问表时候自动加上;
- 读锁 增删改查时候添加；
- 写锁 表结构变更时候添加；
- 读锁之间不互斥；
- 读写锁之间互斥，写锁之间互斥；
- 所以说，修改表结构时候会终止所有的增删改查；
- 在写锁之前的所有增删改查不会阻塞，但在写锁之后的所有增删改查会组色掉，所以修改表结构需谨慎；
- 长事务会长时间的占用MDL读锁；
- MDL在事务提交时候才释放；

# 3 行级锁
